---
import BaseLayout from '@layouts/BaseLayout.astro';
import Header from '@components/header.astro';
import Footer from '@components/footer.astro';
import ProjectCard from '@components/project-card.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects');

// Группировка по статусам
const projectsByStatus = {
  'завершен': allProjects.filter(p => p.data.status.toLowerCase() === 'завершен'),
  'в процессе': allProjects.filter(p => p.data.status.toLowerCase() === 'в процессе'),
  'планируется': allProjects.filter(p => p.data.status.toLowerCase() === 'планируется')
};

const completedCount = projectsByStatus['завершен'].length;
const inProgressCount = projectsByStatus['в процессе'].length;
const plannedCount = projectsByStatus['планируется'].length;
---

<BaseLayout>
  <Header/>
  
  <!-- Breadcrumbs -->
  <nav class="bg-white border-b border-stone-200 py-3">
    <div class="container mx-auto px-4">
      <ol class="flex text-stone-600 text-sm">
        <li><a href="/" class="hover:text-orange-600">Главная</a></li>
        <li class="mx-2">/</li>
        <li class="text-stone-900">Наши проекты</li>
      </ol>
    </div>
  </nav>

  <main class="bg-stone-50 py-12">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-stone-800 mb-4">Наши проекты</h1>
        <p class="text-stone-600 max-w-3xl mx-auto text-lg">
          Объекты, на которых мы выполнили стабилизацию грунтов. 
          Каждый проект - это результат профессионального подхода и использования современных технологий.
        </p>
      </div>

      <!-- Статистика проектов -->
      <div class="grid md:grid-cols-3 gap-6 mb-12">
        <div class="bg-white rounded-xl p-6 text-center">
          <div class="text-3xl font-bold text-green-600 mb-2">{completedCount}</div>
          <div class="text-stone-600">Завершенных проектов</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center">
          <div class="text-3xl font-bold text-blue-600 mb-2">{inProgressCount}</div>
          <div class="text-stone-600">Проектов в работе</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center">
          <div class="text-3xl font-bold text-yellow-600 mb-2">{plannedCount}</div>
          <div class="text-stone-600">Планируемых проектов</div>
        </div>
      </div>

      <!-- Фильтры по статусам -->
      <div class="flex flex-wrap justify-center gap-4 mb-12">
        <button class="status-filter active bg-orange-600 text-white px-4 py-2 rounded-lg font-medium" data-status="all">
          Все проекты
        </button>
        <button class="status-filter bg-white text-stone-700 px-4 py-2 rounded-lg font-medium border border-stone-300 hover:bg-stone-50" data-status="завершен">
          Завершенные
        </button>
        <button class="status-filter bg-white text-stone-700 px-4 py-2 rounded-lg font-medium border border-stone-300 hover:bg-stone-50" data-status="в процессе">
          В процессе
        </button>
        <button class="status-filter bg-white text-stone-700 px-4 py-2 rounded-lg font-medium border border-stone-300 hover:bg-stone-50" data-status="планируется">
          Планируемые
        </button>
      </div>

      <!-- Проекты по статусам -->
      {Object.entries(projectsByStatus).map(([status, projects]) => (
        projects.length > 0 && (
          <div class="project-status-group mb-16" data-status={status}>
            <h2 class="text-2xl font-bold text-stone-800 mb-8 border-b border-stone-200 pb-4 capitalize">{status}</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {projects.map((project) => (
                <ProjectCard project={project} />
              ))}
            </div>
          </div>
        )
      ))}
      
      {allProjects.length === 0 && (
        <div class="text-center py-12">
          <p class="text-stone-600 text-lg">Информация о проектах скоро появится</p>
        </div>
      )}

      <!-- Призыв к действию -->
      <div class="bg-white rounded-xl p-8 mt-16">
        <div class="text-center">
          <h2 class="text-2xl font-bold text-stone-800 mb-4">Хотите стать нашим следующим успешным проектом?</h2>
          <p class="text-stone-600 mb-6 max-w-2xl mx-auto">
            Мы готовы взяться за проекты любой сложности. Свяжитесь с нами для обсуждения вашего проекта и получения коммерческого предложения.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="#contact" class="bg-orange-600 hover:bg-orange-700 text-white font-medium py-3 px-6 rounded-lg transition duration-300">
              Обсудить проект
            </a>
            <a href="/technologies" class="bg-white hover:bg-stone-100 text-stone-800 font-medium py-3 px-6 rounded-lg border border-stone-300 transition duration-300">
              Наши технологии
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <Footer/>
</BaseLayout>

<script>
  // Фильтрация по статусам
  document.addEventListener('DOMContentLoaded', () => {
    const filterButtons = document.querySelectorAll('.status-filter');
    const statusGroups = document.querySelectorAll('.project-status-group');
    
    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        const status = button.getAttribute('data-status');
        
        // Обновляем активную кнопку
        filterButtons.forEach(btn => btn.classList.remove('active', 'bg-orange-600', 'text-white'));
        filterButtons.forEach(btn => btn.classList.add('bg-white', 'text-stone-700'));
        button.classList.add('active', 'bg-orange-600', 'text-white');
        button.classList.remove('bg-white', 'text-stone-700');
        
        // Показываем/скрываем группы проектов
        statusGroups.forEach(group => {
          if (status === 'all' || group.getAttribute('data-status') === status) {
            group.style.display = 'block';
          } else {
            group.style.display = 'none';
          }
        });
      });
    });
  });
</script>
</BaseLayout>